name: 'AWS CLI'
description: 'Automate basic aws cli commands.'
inputs:
  TASK:
    description: 'Trigger the functionallity that is provided by this action.'
    required: true
  ACTION:
    description: 'What the cli will do'
    required: true
  IP:
    description: 'The IP that need to be add/remove from security group'
    required: false
  SG_ID:
    description: 'AWS Security group ID'
    required: false
outputs:
  CLI_RESPONSE:
    description: 'Return json response'
    value: ${{ steps.security_group_rules.outputs.RESPONSE }}
runs:
  using: "composite"
  steps:
    - name: Update Scurity Group rules
      id: security_group_rules
      if: (inputs.TASK == 'security_group_rules') && (inputs.IP != '[]')
      env:
        IP: ${{ inputs.IP }}
        SG_ID: ${{ inputs.SG_ID }}
        ACTION: ${{ inputs.ACTION }}
      shell: bash
      run: |
        if [ "$IP" == "runner_ip" ]; then
          THIS_IP=$(curl ifconfig.me)
        else
          THIS_IP="$IP"
        fi
        sudo apt install jq -y
        echo "Security group id: $SG_ID"
        echo "IP: $IP"
        echo "THIS_IP: $THIS_IP"
        echo "ACTION: $ACTION"
